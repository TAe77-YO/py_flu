<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DevStudy: Python & Flutter</title>
    <!-- React & Tailwind & Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <link href="https://cdn.jsdelivr.net/npm/lucide-static@0.321.0/font/lucide.min.css" rel="stylesheet">

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, doc, deleteDoc, getDocs } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        window.FirebaseSDK = { 
            initializeApp, getAuth, signInAnonymously, onAuthStateChanged, 
            getFirestore, collection, addDoc, query, onSnapshot, doc, deleteDoc, getDocs 
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap');
        body { font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; background-color: #f8fafc; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .code-font { font-family: 'Courier New', Courier, monospace; }
        .glass-card { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 로또 앱에서 사용하신 설정 그대로 유지
        const firebaseConfig = {
            apiKey: "AIzaSyDgx9NCQiQn1dRm6fecK__pAoVFYN2d2q8",
            authDomain: "angellas.firebaseapp.com",
            projectId: "angellas",
            storageBucket: "angellas.firebasestorage.app",
            messagingSenderId: "520824812438",
            appId: "1:520824812438:web:182fd3231b94b9c58ce3b7"
        };

        const studyAppId = "angellas-dev-study-app";

        const STUDY_CONTENT = {
            python: [
                { id: 'p1', title: '변수와 자료형', content: 'Python에서 변수는 선언 없이 바로 사용합니다.\n예: x = 10, name = "Alice"', code: 'x = 10\nprint(type(x)) # <class \'int\'>' },
                { id: 'p2', title: '리스트와 딕셔너리', content: '데이터 꾸러미입니다. []는 리스트, {}는 딕셔너리.', code: 'fruits = ["apple", "banana"]\nuser = {"name": "Alice", "age": 25}' },
                { id: 'p3', title: '조건문과 반복문', content: 'if문과 for/while문으로 흐름을 제어합니다. 들여쓰기가 매우 중요합니다.', code: 'for i in range(5):\n    if i % 2 == 0:\n        print(i)' }
            ],
            flutter: [
                { id: 'f1', title: '모든 것은 위젯', content: 'Flutter UI는 위젯들의 조합입니다. MaterialApp, Scaffold가 기본입니다.', code: 'Scaffold(\n  appBar: AppBar(title: Text("Hello")),\n  body: Center(child: Text("World")),\n)' },
                { id: 'f2', title: 'Stateless vs Stateful', content: '변하지 않는 화면은 Stateless, 데이터에 따라 바뀌면 Stateful 위젯을 씁니다.', code: 'class MyWidget extends StatelessWidget {\n  @override\n  Widget build(BuildContext context) { ... }\n}' },
                { id: 'f3', title: 'Layout 위젯', content: 'Row는 가로, Column은 세로로 위젯을 배치합니다.', code: 'Column(\n  children: [\n    Text("Top"),\n    Text("Bottom"),\n  ],\n)' }
            ]
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [activeSubject, setActiveSubject] = useState('python'); // 'python' or 'flutter'
            const [view, setView] = useState('home'); // 'home', 'learn', 'notes'
            const [selectedLesson, setSelectedLesson] = useState(null);
            const [savedNotes, setSavedNotes] = useState([]);
            const [isLoaded, setIsLoaded] = useState(false);

            // Firebase 인증
            useEffect(() => {
                const init = async () => {
                    const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged } = window.FirebaseSDK;
                    const app = initializeApp(firebaseConfig);
                    const auth = getAuth(app);
                    await signInAnonymously(auth);
                    onAuthStateChanged(auth, (u) => { setUser(u); setIsLoaded(true); });
                };
                const timer = setInterval(() => { if (window.FirebaseSDK) { init(); clearInterval(timer); } }, 500);
                return () => clearInterval(timer);
            }, []);

            // 클라우드 노트 실시간 동기화
            useEffect(() => {
                if (!user) return;
                const { getFirestore, collection, query, onSnapshot, initializeApp } = window.FirebaseSDK;
                const db = getFirestore(initializeApp(firebaseConfig));
                
                const q = query(collection(db, 'artifacts', studyAppId, 'users', user.uid, 'studyNotes'));
                const unsub = onSnapshot(q, (s) => {
                    setSavedNotes(s.docs.map(d => ({ id: d.id, ...d.data() })).sort((a,b) => b.createdAt - a.createdAt));
                });
                return () => unsub();
            }, [user]);

            // 노트 저장 기능
            const saveNote = async (lesson) => {
                const { getFirestore, collection, addDoc, initializeApp } = window.FirebaseSDK;
                const db = getFirestore(initializeApp(firebaseConfig));
                try {
                    await addDoc(collection(db, 'artifacts', studyAppId, 'users', user.uid, 'studyNotes'), {
                        subject: activeSubject,
                        title: lesson.title,
                        content: lesson.content,
                        code: lesson.code,
                        createdAt: Date.now()
                    });
                    alert("학습 노트에 저장되었습니다!");
                } catch (e) { alert("저장 실패"); }
            };

            const deleteNote = async (id) => {
                const { getFirestore, doc, deleteDoc, initializeApp } = window.FirebaseSDK;
                const db = getFirestore(initializeApp(firebaseConfig));
                await deleteDoc(doc(db, 'artifacts', studyAppId, 'users', user.uid, 'studyNotes', id));
            };

            if (!isLoaded) return <div className="min-h-screen flex items-center justify-center text-slate-400 font-black animate-pulse">DEV STUDY LOADING...</div>;

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col pb-20">
                    {/* 상단 헤더 */}
                    <header className="p-6 pt-10 flex justify-between items-end">
                        <div>
                            <h1 className="text-3xl font-black text-slate-800 tracking-tighter">DevStudy Pro</h1>
                            <p className="text-slate-400 text-xs font-bold uppercase tracking-widest mt-1">Smart Learning System</p>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={() => setActiveSubject('python')} className={`px-3 py-1.5 rounded-xl text-[10px] font-black transition-all ${activeSubject === 'python' ? 'bg-yellow-400 text-slate-900 shadow-md' : 'bg-white text-slate-400'}`}>PYTHON</button>
                            <button onClick={() => setActiveSubject('flutter')} className={`px-3 py-1.5 rounded-xl text-[10px] font-black transition-all ${activeSubject === 'flutter' ? 'bg-blue-500 text-white shadow-md' : 'bg-white text-slate-400'}`}>FLUTTER</button>
                        </div>
                    </header>

                    {/* 메인 콘텐츠 영역 */}
                    <main className="flex-1 p-4 overflow-y-auto custom-scrollbar">
                        {view === 'home' && (
                            <div className="space-y-6 animate-in fade-in duration-500">
                                <div className="p-8 rounded-[2.5rem] bg-gradient-to-br from-slate-800 to-slate-900 text-white shadow-2xl relative overflow-hidden">
                                    <i className="lucide-zap absolute -right-4 -bottom-4 w-32 h-32 opacity-10"></i>
                                    <h2 className="text-xl font-black mb-2">오늘의 학습 도전</h2>
                                    <p className="text-slate-400 text-sm leading-relaxed mb-6">자투리 시간을 활용해 {activeSubject === 'python' ? '파이썬' : '플러터'} 마스터가 되어보세요.</p>
                                    <button onClick={() => setView('learn')} className="w-full py-4 bg-white text-slate-900 rounded-2xl font-black text-sm shadow-xl active:scale-95 transition-all">학습 시작하기</button>
                                </div>

                                <div className="grid grid-cols-2 gap-4">
                                    <div className="p-6 bg-white rounded-3xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                                        <div className="w-12 h-12 bg-indigo-50 text-indigo-500 rounded-2xl flex items-center justify-center mb-3">
                                            <i className="lucide-book-open w-6 h-6"></i>
                                        </div>
                                        <span className="text-xs font-black text-slate-400 uppercase">Lesson Count</span>
                                        <span className="text-xl font-black text-slate-800">{STUDY_CONTENT[activeSubject].length}</span>
                                    </div>
                                    <div className="p-6 bg-white rounded-3xl shadow-sm border border-slate-100 flex flex-col items-center text-center">
                                        <div className="w-12 h-12 bg-rose-50 text-rose-500 rounded-2xl flex items-center justify-center mb-3">
                                            <i className="lucide-star w-6 h-6"></i>
                                        </div>
                                        <span className="text-xs font-black text-slate-400 uppercase">Saved Notes</span>
                                        <span className="text-xl font-black text-slate-800">{savedNotes.filter(n => n.subject === activeSubject).length}</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'learn' && (
                            <div className="space-y-4 animate-in slide-in-from-bottom-4 duration-500">
                                <div className="flex items-center gap-2 mb-4">
                                    <button onClick={() => setView('home')} className="p-2 bg-white rounded-xl shadow-sm"><i className="lucide-chevron-left w-5 h-5"></i></button>
                                    <h2 className="font-black text-slate-800 uppercase tracking-tight">{activeSubject} 기초 강의</h2>
                                </div>
                                {STUDY_CONTENT[activeSubject].map((lesson) => (
                                    <div key={lesson.id} className="p-6 bg-white rounded-[2rem] shadow-sm border border-slate-100 space-y-4">
                                        <div className="flex justify-between items-center">
                                            <h3 className="font-black text-slate-800">{lesson.title}</h3>
                                            <button onClick={() => saveNote(lesson)} className="p-2 text-slate-300 hover:text-indigo-500 transition-colors"><i className="lucide-bookmark w-5 h-5"></i></button>
                                        </div>
                                        <p className="text-slate-500 text-sm leading-relaxed">{lesson.content}</p>
                                        <div className="p-4 bg-slate-900 rounded-2xl">
                                            <pre className="code-font text-[11px] text-green-400 overflow-x-auto"><code>{lesson.code}</code></pre>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'notes' && (
                            <div className="space-y-4 animate-in fade-in duration-500">
                                <h2 className="font-black text-slate-800 uppercase tracking-tight mb-4 flex items-center gap-2">
                                    <i className="lucide-folder-heart text-rose-500 w-5 h-5"></i> 나의 학습 저장소
                                </h2>
                                {savedNotes.length > 0 ? savedNotes.map((note) => (
                                    <div key={note.id} className="p-5 bg-white rounded-3xl shadow-sm border border-slate-100 space-y-3 relative overflow-hidden group">
                                        <div className={`absolute top-0 left-0 w-1.5 h-full ${note.subject === 'python' ? 'bg-yellow-400' : 'bg-blue-500'}`}></div>
                                        <div className="flex justify-between items-start">
                                            <div>
                                                <span className="text-[9px] font-black uppercase text-slate-400 tracking-widest">{note.subject}</span>
                                                <h3 className="font-bold text-slate-800">{note.title}</h3>
                                            </div>
                                            <button onClick={() => deleteNote(note.id)} className="p-1 text-slate-200 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition-all"><i className="lucide-trash-2 w-4 h-4"></i></button>
                                        </div>
                                        <p className="text-slate-500 text-xs leading-relaxed line-clamp-2 italic">"{note.content}"</p>
                                        <span className="text-[9px] text-slate-300 font-bold block">{new Date(note.createdAt).toLocaleDateString()} 저장됨</span>
                                    </div>
                                )) : (
                                    <div className="py-20 text-center text-slate-300 flex flex-col items-center gap-3">
                                        <i className="lucide-inbox w-12 h-12 opacity-20"></i>
                                        <p className="text-xs font-black uppercase tracking-widest">저장된 노트가 없습니다.</p>
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    {/* 하단 탭 바 (모바일 앱 느낌) */}
                    <nav className="fixed bottom-0 left-0 right-0 max-w-md mx-auto h-20 bg-white/80 backdrop-blur-xl border-t border-slate-100 flex items-center justify-around px-6 z-50">
                        <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1 transition-all ${view === 'home' ? 'text-indigo-600 scale-110' : 'text-slate-300'}`}>
                            <i className="lucide-home w-6 h-6"></i>
                            <span className="text-[9px] font-black uppercase tracking-tighter">Home</span>
                        </button>
                        <button onClick={() => setView('learn')} className={`flex flex-col items-center gap-1 transition-all ${view === 'learn' ? 'text-indigo-600 scale-110' : 'text-slate-300'}`}>
                            <i className="lucide-graduation-cap w-6 h-6"></i>
                            <span className="text-[9px] font-black uppercase tracking-tighter">Learn</span>
                        </button>
                        <button onClick={() => setView('notes')} className={`flex flex-col items-center gap-1 transition-all ${view === 'notes' ? 'text-indigo-600 scale-110' : 'text-slate-300'}`}>
                            <i className="lucide-bookmark w-6 h-6"></i>
                            <span className="text-[9px] font-black uppercase tracking-tighter">Notes</span>
                        </button>
                    </nav>

                    <footer className="p-8 text-center opacity-30">
                        <p className="text-[10px] font-black tracking-[0.3em] text-slate-400">DEV STUDY PRO v1.0</p>
                    </footer>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
